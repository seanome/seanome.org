{{/* Hugo Shortcode: Render people grouped by user_groups */}}

{{ $groups := split (.Get "groups") "," }}
{{ $sortKey := default "sort_order" (.Get "sort_by") }}
{{ $ascending := eq (.Get "ascending") "true" }}

{{ $allAuthors := where site.RegularPages "Section" "authors" }}

{{ range $group := $groups }}
{{ $people := where $allAuthors ".Params.user_groups" "intersect" (slice $group) }}
{{ $people = sort $people (printf "Params.%s" $sortKey) }}
{{ if not $ascending }}
{{ $reversed := slice }}
{{ range last (len $people) $people }}
{{ $reversed = $reversed | append . }}
{{ end }}
{{ $people = $reversed }}
{{ end }}

{{ if gt (len $people) 0 }}
<section class="people-group">
    <h3 style="text-align: center; margin-top: 2rem;">{{ $group }}</h3>
    <div class="people-section">
        {{ range $people }}
        <div class="person-card">
            {{ $name := .Params.name }}
            {{ $avatar := .Params.avatar }}
            <img src='{{ "/media/people/" | relURL }}{{ $avatar }}' alt="{{ $name }}" width="150" height="150"
                style="border-radius: 50%;">
            <h4>{{ $name }}</h4>
            {{ with .Params.role }}<p><em>{{ . }}</em></p>{{ end }}
            {{ with .Params.bio }}<p>{{ . }}</p>{{ end }}
            <p>
                {{ with .Params.social.lab_website }}<a href="{{ . }}" target="_blank">Lab Website</a>{{ end }}
                {{ with .Params.social.linkedin }}<a href="{{ . }}" target="_blank">LinkedIn</a>{{ end }}
                {{ with .Params.social.github }} • <a href="{{ . }}" target="_blank">GitHub</a>{{ end }}
                {{ with .Params.social.twitter }} • <a href="https://twitter.com/{{ . }}" target="_blank">Twitter</a>{{
                end }}
            </p>
        </div>
        {{ end }}
    </div>
</section>
{{ end }}
{{ end }}